# **üîπ Anleitung: SSH-Agent einrichten & mit KeePassXC nutzen**

## **1 SSH-Agent unter Windows starten**

Der **SSH-Agent** ist ein Dienst unter Windows, der private SSH-Schl√ºssel verwaltet, sodass diese nicht bei jeder Verbindung erneut eingegeben werden m√ºssen.

Hier ist die √ºberarbeitete Version mit deiner gew√ºnschten √Ñnderung:  

---

### **1.1. √úberpr√ºfen, ob der OpenSSH Authentication Agent l√§uft und ihn aktivieren**  

Damit SSH-Authentifizierung funktioniert, muss der **OpenSSH Authentication Agent (ssh-agent)** aktiv sein. Befolge diese Schritte, um den Dienst zu √ºberpr√ºfen und zu starten.  

#### **1. Dienste-Verwaltung √∂ffnen**  
1. Dr√ºcke **Win + R**, gib `services.msc` ein und best√§tige mit **Enter**.  
2. Es √∂ffnet sich das Fenster **Dienste**, in dem alle Systemdienste aufgelistet sind.  

#### **2. SSH-Agent-Dienst finden und starten**  
1. Klicke auf einen beliebigen Dienst in der Liste.  
2. Dr√ºcke die Taste **O** auf der Tastatur, um direkt zu den Diensten zu springen, die mit **O** beginnen.  
3. Suche in der Liste nach **OpenSSH Authentication Agent**.  
4. √úberpr√ºfe die **Status**-Spalte:  
   - Falls der Dienst bereits l√§uft, ist keine weitere Aktion erforderlich.  
   - Falls er **nicht l√§uft**, gehe wie folgt vor:  
     1. Doppelklicke auf **OpenSSH Authentication Agent**, um die **Eigenschaften** zu √∂ffnen.  
     2. Klicke auf **Starten**, um den Dienst zu aktivieren.  

#### **3. Automatischen Start aktivieren (optional)**  
Damit der Dienst bei jedem Systemstart automatisch gestartet wird:  
1. Im gleichen Eigenschaften-Fenster findest du den Eintrag **Starttyp**.  
2. W√§hle **Automatisch** aus der Dropdown-Liste.  
3. Klicke auf **√úbernehmen** und dann auf **OK**.  

Nun l√§uft der **ssh-agent** dauerhaft im Hintergrund und steht f√ºr SSH-Authentifizierungen bereit.  


### **1.2. SSH-Agent aktivieren & starten**

Falls der SSH-Agent **gestoppt oder deaktiviert** ist:

1. Klicke mit der **rechten Maustaste** auf **ssh-agent**.
2. W√§hle **Starten**, um den Dienst zu starten.
3. Falls der Dienst nach einem Neustart nicht automatisch startet:
   - Klicke mit der rechten Maustaste auf **ssh-agent**.
   - W√§hle **Eigenschaften**.
   - Setze den **Starttyp** auf **Automatisch**.
   - Klicke auf **√úbernehmen** und dann auf **OK**.

üîπ **Testen, ob der SSH-Agent l√§uft:**

Wechsle zur√ºck zum Reiter **Dienste** und √ºberpr√ºfe, ob der **Status nun "Wird ausgef√ºhrt"** lautet.

---

## **2Ô∏è SSH-Agent in KeePassXC aktivieren**

Damit KeePassXC SSH-Schl√ºssel verwalten und automatisch an den SSH-Agent √ºbergeben kann, muss die **SSH-Agent-Integration** aktiviert werden.

### **2.1. SSH-Agent-Integration in KeePassXC aktivieren**

1. **KeePassXC √∂ffnen**.
2. Gehe zu  **Einstellungen**.
3. Navigiere zum Tab **SSH-Agent**.
4. Aktiviere **"SSH-Agent-Integration aktivieren"**.
5. Stelle sicher, dass **"OpenSSH f√ºr Windows verwenden"** aktiviert ist.
6. Klicke auf **OK**, um die Einstellungen zu speichern.

---

## **3 Korrekte SSH-Agent-Socket setzen**

Unter Windows muss die **richtige SSH-Agent-Socket (`SSH_AUTH_SOCK`) manuell gesetzt werden.

### **3.1. Richtige SSH-Socket setzen**

√ñffne **PowerShell (nicht als Admin!)** und setze die **richtige Socket**:

```powershell
$env:SSH_AUTH_SOCK = "\\.\pipe\openssh-ssh-agent"
```

### **3.2. Diese Einstellung dauerhaft speichern**

## `$env:SSH_AUTH_SOCK` nach Neustart beibehalten

Damit die Umgebungsvariable `$env:SSH_AUTH_SOCK` auch nach einem Neustart bestehen bleibt, kannst du sie entweder in dein PowerShell-Profil oder als System-Umgebungsvariable hinzuf√ºgen.

---

### **In das PowerShell-Profil einf√ºgen (Benutzerspezifisch)**

Diese Methode sorgt daf√ºr, dass die Variable bei jedem Start von PowerShell automatisch gesetzt wird.

1. **PowerShell √∂ffnen** und √ºberpr√ºfen, ob das Profil existiert:

   ```powershell
   if (!(Test-Path $PROFILE)) { New-Item -ItemType File -Path $PROFILE -Force }
   ```

2. **Profil-Datei im Editor √∂ffnen:**

   ```powershell
   notepad $PROFILE
   ```

3. **Folgende Zeile am Ende der Datei hinzuf√ºgen:**

   ```powershell
   $env:SSH_AUTH_SOCK = "\\.\pipe\openssh-ssh-agent"
   ```

4. **Datei speichern und Notepad schlie√üen.**

(Schlie√üe zuerst den Tab in Notepad damit sich dieser nicht wieder √∂ffnet beim n√§chsten Starten von Notepad!)
Jetzt wird die Umgebungsvariable bei jedem Start von PowerShell automatisch gesetzt.

---

## **3.3üîπ Testen, ob der SSH-Agent funktioniert:**

Starte KeepassXC neu: **Datenbank > Beenden** (oder **Strg + Q**).\
**√ñffne und Entsperre** die Datenbank in welcher der SSH-Key gespeichert ist erneut.\
Nun √ºberpr√ºfe ob der SSH-Key dem ssh-agent zurverf√ºgung steht. Tippe daf√ºr in Powershell folgendes ein:

```powershell
ssh-add -l
```

## **4 Verbindung zu DietPi via SSH herstellen**

Nachdem der SSH-Agent l√§uft und der Schl√ºssel geladen ist, kann die Verbindung zu **DietPi** hergestellt werden.

üîπ **Verbindung testen:**

```powershell
ssh dietpi@10.5.0.115
```

Falls die Verbindung nicht funktioniert, f√ºhre sie mit **mehr Debug-Informationen** aus:

```powershell
ssh -vvv dietpi@10.5.0.115
```

